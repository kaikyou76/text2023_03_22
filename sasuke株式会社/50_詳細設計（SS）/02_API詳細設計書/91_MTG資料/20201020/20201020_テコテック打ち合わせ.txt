2020年10月20日　テコテック打ち合わせ

■保険料レンジ取得API
エラーコードの記載が足りていない

・「プロセス」シート
チェック内容やエラーレスポンスの詳細は別紙「API共通設計書」に記載とさせていただきたい。

API共通設計書については、まだ作成途中
→後ほど確認させていただく

・基幹系基盤API
項目名と設定値と参考値を貼り付ける形となっています。
証券番号は固定値？
→このAPIを使用するときはまだ証券番号が決まっていないので。。

もれなく記載されているのかどうかが評価しづらい。

戻り値も機関系APIの戻り値に合わせて


List<保険料レンジDTO>

おまとめの検討が機関API側で進んでいるので、そういったことに対応するために、主契約部分も複数で受けられるようにしたほうがいいように思います。

機関系APIの仕様が変更したあとで対応で良いか？（テコテック）
→機関系APIになるべく振り回されないようにするために、予め複数受けられるようにしておいたほうが良いのではないかと考えている（石井）


となるとシーケンスが変わってくる。
複数回すような仕組みになっていくことになる。

インプットについてはすぐに対応する。（石井）
バックエンドについては、いったん単数で返していただければよい。


プロセス詳細のバリュー値
型エラーは、Integerかどうかとかそういったチェック？
不正な形式は詳細を記載いただきたい。
→承知した。（テコテック）

日付の定義はどのような形式か決まっているのか？
→基本的にはyyyymmdd hh:mm:ss
→スラなしコロンデリミタなし方針でいきたい
→承知した（テコテック）

性別はコード体系内かどうかをチェックするのか？

内部レビューは通っている状態なのか？
→これは間に合っていないドキュメントです。
→できれば今後は内部レビューが通ったものをレビュー対象としてください。


・レスポンスの部分
APIの戻り値がそのまま返します。
→承知した（石井）


■仮アカウント発行APIレビュー

仮アカウントについての質問事項があるのでこの場で回答をお願いいたします。
・入力チェック
先程のレビューにのっとり、型チェックなどを後ほど追加する。

個人テーブル.個人IDはオートインクリメントか？
→オートインクリメントです

個人ID（新規作成時は不要）というのは？
→個人DTOをエンティティから作成している
→入力はしないけど項目としては用意しているだけ


・アカウント.アカウントIDはオートインクリメント？
→

・認証ハッシュテーブル
Md5を採用
猶予時間は２時間までとしている（環境設定で設定できるようにする）

初期パスワードについては？
→

メールには初期パスワードには設定しない（石井）

入力パラメータのI/Fにパスワードを追加する。（石井）→★サスケ宿題


メール送信失敗したときはデータはつくられたまま？
→トランザクションの貼り直しをします。メール送信も含める

プロセス詳細は先程のレビュー同様記載ください。（石井）

2.2
VALUESのところに【値】と書いてあるのは意味がないのでは？
→具体名を書くように修正する。（テコテック）宿題


60行目のSQL部分は？
→３行でワンセットです
→見づらいので可視性を考慮してください。
→承知しました（テコテック）宿題

・シーケンス図の文言
「仮アカウント情報の登録」と下の２番のタイトルを一致させたほうがいいのかと思います（石井）
→承知しました（テコテック）宿題

・アカウントテーブル
現在日付？
→現在に日時に修正します（テコテック）宿題

個人IDはINSERTしたあとにとってくる？
INSERTした結果で取得？
ミドルウェアで吸収した場合どうやってIDを特定するのか？
→INSERTした結果でIDが受け取れる想定（テコテック）

・認証テーブルにレコード作成
「リクエストパラメータのメールアドレス」は誤記です。（テコテック）

最終ログイン日時についてはこの時点ではまだ設定してはいけない。（石井）
NNではないので、こちらはNULL値を設定する。（テコテック）宿題

ログイン試行回数は？
→ログイン試行回数は記載されていないので０で設定するようにします（テコテック）宿題

本登録日時はNNついてしまっているが、まずいですよね？
→本登録日時のNNは外す（DB定義修正：サスケ）宿題

パスワードのハッシュ関数をつかってDBに登録する。
sha256を使用します。（石井）
→ソルトつきがよく使われる（テコテック）
→どれぐらい強度があるものなのか？
→sha256でも問題ないが暗号化の速度が早いのでdcryptがよく使われる。
→dcryptについて調査する：サスケ宿題

・商品付加テーブル
入力値を確認しないとわからないところがある。

更新日時：
現在日付→現在日時にしてください

試算結果：
もともと主契約と特約がjson形式が渡される予定だったが、主契約と特約のテーブルを更新しに行く
エンティティ定義は作成済みなので、まだ多少変わる部分は出てくるがそれを参照ください。
→試算結果はなくなる想定？
→なくなる想定です。

告知完了日：
指定しなくてOK
→NULL値を設定

契約年齢：
データベースのカラムとして削除済み

証券番号の値まではNULL値でOK

契約日に関する特則の値：
リクエストパラメータで設定する予定
productDesignの中に設定されています（石井）
→申込データ連動のほうに元ネタがある


代理店コードの値：
リクエストパラメータに追加予定

差分あり、取り消し済み：
FALSEでOK


・VALUESについては、全部書いてあったり端折ってあったりする
→全量記載するようにする（テコテック）宿題


・契約日に関する特則についての用途
契約した次の月の１日を保険料計算基準日とする。
その月に誕生日を迎える人は年齢が一つ上がってしまう。



・承諾テーブルの承諾日時は？
→現在日時を設定してください


・リクエストパラメータproductDesigns.basePolicy、ProductDesigns.riderの用途
→主契約、特約です。
→こちらのほうに主契約、特約が入ってくる。


「トランザクションを終了する」の位置は修正します（テコテック）


・メール送信
メール送信に失敗したときに500を発砲しちゃうのはまずい（石井）
→入力チェックで防ぐ予定（テコテック）

システム上の理由でメールがおくれなくなったときは500でいいが、
→こちらは400に変更させていただきます（テコテック）


４番入力されたメソッドコールはフォローメール送信のほうを使うんですか？
どういうふうに関連しているのかが分からない（石井）
→メール送信のところと合わせて対応とさせてください（テコテック）

メッセージIDとエラーメッセージはどこかで利用する予定ですか？
→今の所仕様想定は有りません。（テコテック）


■パスワード再設定APIレビュー

入力チェックのところは同様に修正します。

仮アカウント発行時にメールを送るが、そのときに個人オブジェクトを渡していると思うが、
それは渡さなくていい。
個人情報は送らない要件になっているので。
メールの中身に個人情報を使わないようになっている。

アカウントIDが存在しない場合は、HTTPステータス:200を応答するが良いのではないかと考えている（テコテック）
→バックエンドの戻り値としては400がよいと考えている。
→400を受けて画面側がハンドリングすれば良いと考えている（石井）
→承知しました。400で返すようにします（テコテック）宿題

3番
ハッシュ関数についてはmd5で妥当か？
→2時間の間に特定されなければ良いと考えている。
→念の為確認させていただきます。（テコテック）宿題


4番
こちらも個人情報は不要で良い（石井）
仮アカウント発行時と同じポリシーで考えてほしい。

・シーケンス図にトランザクションがない
→認証ハッシュとメール送信をトランザクションで囲みます（テコテック）宿題

メール送信の部分は非同期だと思っているが、戻り値を判断できるのか？（石井）
→特にハードバウンスが起きない限りは問題なくメール送信結果を取れる？
→結果を受けられるのかが分からない
→SESから通知を受け取って

→SESに投げるところまでのステータスとなります（テコテック）
→ハードバウンスは検知できない

































